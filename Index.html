<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RS COMMAND CENTER | ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@100;300;400;600&family=Prompt:wght@100;300;600;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Kanit', 'sans-serif'], title: ['Prompt', 'sans-serif'] },
                    colors: { brand: '#F0B90B', bgDark: '#010409', cardDark: '#0D1117' }
                }
            }
        }
    </script>

    <style>
        body { background-color: #010409; color: #E6EDF3; font-family: 'Kanit', sans-serif; }
        .stat-card { background: #0D1117; border: 1px solid #30363d; border-radius: 1.5rem; transition: 0.3s; }
        .stat-card:hover { border-color: var(--brand); transform: translateY(-5px); }
        .user-row:hover { background: rgba(240, 185, 11, 0.02); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="flex flex-col lg:flex-row min-h-screen">

    <div id="loader" class="fixed inset-0 z-[1000] bg-bgDark flex flex-col items-center justify-center">
        <i class="fas fa-user-shield text-brand text-5xl animate-bounce mb-4"></i>
        <p class="text-brand font-black tracking-widest text-xs uppercase">Authenticating Admin...</p>
    </div>

    <div id="authPage" class="hidden fixed inset-0 z-[900] bg-bgDark flex items-center justify-center p-6">
        <div class="max-w-sm w-full p-10 bg-cardDark rounded-[3rem] text-center border border-brand/20 shadow-2xl">
            <h1 class="text-3xl font-black text-white italic font-title uppercase mb-2">Admin <span class="text-brand">Login</span></h1>
            <p class="text-slate-500 text-[10px] font-bold uppercase mb-10 tracking-widest">RS Command Hub</p>
            <div class="space-y-4">
                <input id="lEmail" type="email" class="w-full p-5 bg-bgDark border border-slate-800 rounded-2xl text-white outline-none focus:border-brand" placeholder="Admin Email">
                <input id="lPass" type="password" class="w-full p-5 bg-bgDark border border-slate-800 rounded-2xl text-white outline-none focus:border-brand" placeholder="Password">
                <button onclick="admin.login()" class="w-full bg-brand text-bgDark py-5 rounded-2xl font-black uppercase text-xs shadow-xl">Unlock System</button>
            </div>
        </div>
    </div>

    <aside class="w-full lg:w-72 p-8 bg-cardDark border-r border-slate-800 flex flex-col hidden" id="sideNav">
        <div class="flex items-center gap-3 mb-12">
            <div class="w-10 h-10 bg-brand rounded-xl flex items-center justify-center text-bgDark font-black italic">RS</div>
            <h2 class="text-white font-black text-lg font-title tracking-tighter uppercase">Command</h2>
        </div>
        <nav class="space-y-2 flex-1">
            <button onclick="ui.view('users')" class="w-full p-4 rounded-xl text-brand font-bold flex items-center gap-4 bg-brand/10 border border-brand/20 transition-all"><i class="fas fa-users"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
            <button onclick="ui.view('signals')" class="w-full p-4 rounded-xl text-slate-400 font-bold flex items-center gap-4 hover:bg-white/5 transition-all"><i class="fas fa-broadcast-tower"></i> ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</button>
        </nav>
        <button onclick="admin.logout()" class="text-rose-500 font-bold text-xs p-4 mt-10 border border-rose-500/20 rounded-xl hover:bg-rose-500 hover:text-white transition-all"><i class="fas fa-power-off mr-2"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </aside>

    <main class="flex-1 p-6 lg:p-12 overflow-y-auto no-scrollbar hidden" id="mainDashboard">
        
        <section id="v-users" class="space-y-10">
            <header class="flex flex-col lg:flex-row justify-between lg:items-end gap-6">
                <div>
                    <h1 class="text-4xl font-black text-white font-title italic uppercase">User <span class="text-brand">Wallet</span></h1>
                    <p class="text-slate-500 font-bold text-xs uppercase tracking-widest mt-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="stat-card px-6 py-4 text-center"><p class="text-[9px] font-bold text-slate-500 uppercase mb-1">Total Users</p><p id="countUsers" class="text-xl font-black text-white">0</p></div>
                    <div class="stat-card px-6 py-4 text-center"><p class="text-[9px] font-bold text-slate-500 uppercase mb-1">Total Credits</p><p id="totalCredits" class="text-xl font-black text-brand">‡∏ø 0</p></div>
                </div>
            </header>

            <div class="bg-cardDark border border-slate-800 rounded-3xl overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-bgDark/50 text-[10px] font-black text-slate-500 uppercase tracking-widest border-b border-slate-800">
                        <tr>
                            <th class="p-6">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                            <th>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th>
                            <th class="text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</th>
                        </tr>
                    </thead>
                    <tbody id="userTable">
                        </tbody>
                </table>
            </div>
        </section>

        <section id="v-signals" class="hidden space-y-10">
            <h1 class="text-4xl font-black text-white font-title italic uppercase">Live <span class="text-brand">Feed</span></h1>
            <div id="signalFeed" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                </div>
        </section>

    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, updateDoc, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // üî• FIREBASE CONFIG (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)
        const firebaseConfig = { apiKey: "AIzaSyBNfTBQthLLRbJP9BXZ-UQptFsdU324Mv0", authDomain: "fafada-d9899.firebaseapp.com", projectId: "fafada-d9899", storageBucket: "fafada-d9899.firebasestorage.app", messagingSenderId: "484777586908", appId: "1:484777586908:web:16a8f0367ad15737364419" };
        const app_fb = initializeApp(firebaseConfig);
        const auth = getAuth(app_fb);
        const db = getFirestore(app_fb);

        window.ui = {
            view: (v) => {
                ['users', 'signals'].forEach(id => document.getElementById('v-'+id).classList.add('hidden'));
                document.getElementById('v-'+v).classList.remove('hidden');
            },
            hideLoader: () => { document.getElementById('loader').classList.add('opacity-0'); setTimeout(()=> document.getElementById('loader').classList.add('hidden'), 700); }
        };

        window.admin = {
            login: async () => {
                const em = document.getElementById('lEmail').value.trim();
                const ps = document.getElementById('lPass').value.trim();
                if(em !== 'farisxuma1@gmail.com') return Swal.fire('Denied','‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô','error');
                try { await signInWithEmailAndPassword(auth, em, ps); } catch(e) { Swal.fire('Error','Master Key Incorrect','error'); }
            },
            logout: () => signOut(auth).then(()=>location.reload()),
            updateBalance: async (uid, currentBalance) => {
                const { value: amount } = await Swal.fire({
                    title: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô',
                    input: 'number',
                    inputLabel: '‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏•‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏Å‡∏≠‡∏≠‡∏Å)',
                    inputValue: 0,
                    showCancelButton: true,
                    confirmButtonColor: '#F0B90B'
                });
                if (amount) {
                    const newBalance = parseFloat(currentBalance) + parseFloat(amount);
                    await updateDoc(doc(db, "users", uid), { balance: newBalance });
                    Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                }
            }
        };

        onAuthStateChanged(auth, u => {
            if(u && u.email === 'farisxuma1@gmail.com') {
                document.getElementById('authPage').classList.add('hidden');
                document.getElementById('sideNav').classList.remove('hidden');
                document.getElementById('mainDashboard').classList.remove('hidden');
                ui.hideLoader();

                // üë• Listen to all users
                onSnapshot(collection(db, "users"), s => {
                    const tb = document.getElementById('userTable'); tb.innerHTML = '';
                    let totalUsers = 0; let totalCredits = 0;
                    s.forEach(d => {
                        const u = d.data();
                        totalUsers++; totalCredits += (u.balance || 0);
                        tb.innerHTML += `
                        <tr class="user-row border-b border-slate-800/50 transition-all">
                            <td class="p-6 font-bold text-white">${u.displayName}</td>
                            <td class="text-slate-400 text-xs">${u.email}</td>
                            <td class="font-black text-brand italic">‡∏ø ${(u.balance || 0).toLocaleString()}</td>
                            <td class="p-6 text-center">
                                <button onclick="admin.updateBalance('${d.id}', ${u.balance || 0})" class="px-4 py-2 bg-slate-800 rounded-lg text-[10px] font-black hover:bg-brand hover:text-bgDark transition-all">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</button>
                            </td>
                        </tr>`;
                    });
                    document.getElementById('countUsers').innerText = totalUsers;
                    document.getElementById('totalCredits').innerText = '‡∏ø ' + totalCredits.toLocaleString();
                });

                // üì° Listen to global signals feed
                const q = query(collection(db, "signals"), orderBy("timestamp", "desc"), limit(10));
                onSnapshot(q, s => {
                    const feed = document.getElementById('signalFeed'); feed.innerHTML = '';
                    s.forEach(d => {
                        const sig = d.data();
                        const isBuy = sig.type === 'BUY';
                        feed.innerHTML += `
                        <div class="stat-card p-6 flex justify-between items-center border-l-4 ${isBuy?'border-l-success':'border-l-danger'}">
                            <div>
                                <p class="text-xs font-black text-white uppercase">${sig.name}</p>
                                <p class="text-[9px] text-slate-500">${moment(sig.timestamp?.seconds*1000).fromNow()}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-black ${isBuy?'text-success':'text-danger'}">${sig.type}</p>
                                <p class="text-[9px] text-slate-400">Duration: ${sig.duration}m</p>
                            </div>
                        </div>`;
                    });
                });

            } else {
                document.getElementById('authPage').classList.remove('hidden');
                ui.hideLoader();
            }
        });
    </script>
</body>
</html>
