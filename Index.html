<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TITANIUM - ADMIN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;600&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background: #0f172a; color: #cbd5e1; font-family: 'Sarabun'; }
        .card { background: #1e293b; border: 1px solid #334155; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.3); }
        .input-dk { background: #0f172a; border: 1px solid #334155; color: white; padding: 10px; width: 100%; border-radius: 8px; outline: none; transition: 0.2s; }
        .input-dk:focus { border-color: #c59d5f; }
    </style>
</head>
<body class="p-6">

    <div id="auth" class="flex h-screen items-center justify-center">
        <div class="card w-96 text-center border-t-4 border-[#c59d5f]">
            <h2 class="text-2xl font-bold text-[#c59d5f] mb-6">ADMIN SYSTEM</h2>
            <input id="pass" type="password" class="input-dk text-center mb-4" placeholder="Security Code">
            <button onclick="Admin.login()" class="w-full bg-[#c59d5f] text-white font-bold py-3 rounded-lg hover:bg-[#a3824f]">เข้าสู่ระบบ</button>
        </div>
    </div>

    <div id="panel" class="hidden max-w-6xl mx-auto">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-white"><span class="text-[#c59d5f]">TITANIUM</span> CONTROL</h1>
            <div class="flex gap-3">
                <button id="tog-dep" onclick="Admin.toggle('dep')" class="px-4 py-2 rounded bg-green-900 text-green-400 text-xs font-bold border border-green-500/30">ฝาก: ON</button>
                <button id="tog-wit" onclick="Admin.toggle('wit')" class="px-4 py-2 rounded bg-green-900 text-green-400 text-xs font-bold border border-green-500/30">ถอน: ON</button>
                <button onclick="location.reload()" class="px-4 py-2 rounded bg-red-900 text-red-400 text-xs font-bold border border-red-500/30">LOGOUT</button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <div class="card lg:col-span-2">
                <h3 class="font-bold text-white mb-4 border-b border-white/5 pb-2">รายการรออนุมัติ</h3>
                <div id="tx-list" class="space-y-2 max-h-[500px] overflow-y-auto pr-2"></div>
            </div>

            <div class="space-y-6">
                <div class="card">
                    <h3 class="font-bold text-[#c59d5f] mb-4">ตั้งค่าระบบ</h3>
                    <div class="space-y-3">
                        <input id="s-ann" class="input-dk" placeholder="ประกาศหน้าเว็บ">
                        <input id="s-link" class="input-dk" placeholder="ลิ้งก์ติดต่อ (Line/FB)">
                        <div class="flex gap-2">
                            <input id="s-fee" type="number" class="input-dk" placeholder="ค่าธรรมเนียมถอน %">
                            <input id="s-daily" type="number" class="input-dk" placeholder="แจกรายวัน (บาท)">
                        </div>
                        <button onclick="Admin.saveSet()" class="w-full bg-[#c59d5f] text-white py-2 rounded font-bold text-sm">บันทึกตั้งค่า</button>
                    </div>
                </div>

                <div class="card">
                    <h3 class="font-bold text-blue-400 mb-4">เพิ่มธนาคาร</h3>
                    <div class="flex gap-2 mb-2"><input id="b-name" class="input-dk" placeholder="ชื่อแบงค์"><input id="b-acc" class="input-dk" placeholder="เลขบัญชี"></div>
                    <button onclick="Admin.addBank()" class="w-full bg-blue-600 text-white py-2 rounded font-bold text-sm">เพิ่มบัญชี</button>
                    <div id="bank-list" class="mt-3 space-y-1"></div>
                </div>

                <div class="card">
                    <h3 class="font-bold text-purple-400 mb-4">สร้างโค้ดเครดิตฟรี</h3>
                    <div class="flex gap-2 mb-2"><input id="c-code" class="input-dk uppercase" placeholder="CODE"><input id="c-amt" type="number" class="input-dk" placeholder="จำนวนเงิน"></div>
                    <button onclick="Admin.createCode()" class="w-full bg-purple-600 text-white py-2 rounded font-bold text-sm">สร้างโค้ด</button>
                </div>
            </div>

            <div class="card lg:col-span-3">
                <div class="flex justify-between items-center mb-4 border-b border-white/5 pb-2">
                    <h3 class="font-bold text-white">จัดการสมาชิก & บทลงโทษ</h3>
                    <input onkeyup="Admin.filter(this.value)" class="input-dk w-64 text-xs py-1" placeholder="ค้นหาชื่อ...">
                </div>
                <div id="user-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-[500px] overflow-y-auto"></div>
            </div>

            <div class="card lg:col-span-3">
                <h3 class="font-bold text-green-400 mb-4">จัดการโปรโมชั่น</h3>
                <div class="flex gap-2 mb-4">
                    <input id="p-title" class="input-dk" placeholder="หัวข้อโปรโมชั่น">
                    <input id="p-desc" class="input-dk" placeholder="รายละเอียด">
                    <button onclick="Admin.addPromo()" class="bg-green-600 text-white px-6 rounded font-bold">เพิ่ม</button>
                </div>
                <div id="promo-list" class="space-y-2"></div>
            </div>

        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyDc50wlOejDQi3PTySiQss3bLuVz_-tvB4", authDomain: "walletrs-d6104.firebaseapp.com", projectId: "walletrs-d6104", storageBucket: "walletrs-d6104.firebasestorage.app", messagingSenderId: "496661515180", appId: "1:496661515180:web:42c3a21541cdfc68cf8809", measurementId: "G-2P8SGLR602", databaseURL: "https://walletrs-d6104-default-rtdb.asia-southeast1.firebasedatabase.app" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let settings = {isDepositActive:true, isWithdrawActive:true};

        const Admin = {
            login: () => { if(document.getElementById('pass').value=='admin'){ document.getElementById('auth').style.display='none'; document.getElementById('panel').style.display='block'; Admin.init(); } },
            init: () => {
                // Transactions
                db.ref('transactions').orderByChild('status').equalTo('pending').on('value', s => {
                    const l = document.getElementById('tx-list'); l.innerHTML='';
                    if(!s.exists()) l.innerHTML='<div class="text-center text-slate-600 py-10">ไม่มีรายการค้าง</div>';
                    s.forEach(d => {
                        const t = d.val();
                        l.innerHTML += `
                            <div class="bg-[#0f172a] p-3 rounded-xl border-l-4 ${t.type=='deposit'?'border-green-500':'border-red-500'} flex justify-between items-center">
                                <div><b class="text-white uppercase">${t.type} ฿${t.amount.toLocaleString()}</b><br><span class="text-xs text-slate-400">${t.name} • ${t.time||t.bank_info||''}</span></div>
                                <div class="flex gap-2"><button onclick="Admin.tx('${d.key}','approved','${t.uid}',${t.amount},'${t.type}')" class="bg-green-600 text-white px-3 py-1 rounded text-xs">อนุมัติ</button><button onclick="Admin.tx('${d.key}','rejected','${t.uid}',${t.amount},'${t.type}')" class="bg-red-600 text-white px-3 py-1 rounded text-xs">ปฏิเสธ</button></div>
                            </div>`;
                    });
                });

                // Users
                db.ref('users').on('value', s => {
                    const l = document.getElementById('user-list'); l.innerHTML='';
                    s.forEach(d => {
                        const u = d.val();
                        l.innerHTML += `
                            <div class="bg-[#0f172a] p-3 rounded border border-slate-700 flex justify-between items-center user-item">
                                <div><b class="text-[#c59d5f]">${u.name}</b><br><span class="text-xs text-white">฿${(u.balance||0).toLocaleString()}</span><br><span class="text-[10px] text-slate-500">${u.bank}</span></div>
                                <div class="flex flex-col gap-1">
                                    <button onclick="Admin.penalty('${d.key}','${u.name}')" class="bg-red-900/50 text-red-400 border border-red-500/20 px-2 py-1 rounded text-[10px] hover:bg-red-600 hover:text-white">หักเงิน</button>
                                    <button onclick="Admin.give('${d.key}','${u.name}')" class="bg-green-900/50 text-green-400 border border-green-500/20 px-2 py-1 rounded text-[10px] hover:bg-green-600 hover:text-white">เติมเงิน</button>
                                </div>
                            </div>`;
                    });
                });

                // Settings
                db.ref('settings').on('value', s => {
                    settings = s.val() || {};
                    document.getElementById('s-ann').value = settings.announcement||'';
                    document.getElementById('s-link').value = settings.contactLink||'';
                    document.getElementById('s-fee').value = settings.withdrawFee||0;
                    document.getElementById('s-daily').value = settings.dailyReward||10;
                    
                    const updateTog = (id, val) => {
                        const el = document.getElementById(id);
                        el.innerText = val !== false ? 'ON' : 'OFF';
                        el.className = `px-4 py-2 rounded text-xs font-bold border ${val !== false ? 'bg-green-900 text-green-400 border-green-500/30' : 'bg-red-900 text-red-400 border-red-500/30'}`;
                    };
                    updateTog('tog-dep', settings.isDepositActive);
                    updateTog('tog-wit', settings.isWithdrawActive);

                    const bl=document.getElementById('bank-list'); bl.innerHTML='';
                    if(settings.banks) Object.entries(settings.banks).forEach(([k,v]) => bl.innerHTML+=`<div class="flex justify-between bg-black/30 p-2 rounded text-xs text-slate-400 mb-1"><span>${v.name}-${v.acc}</span><span onclick="db.ref('settings/banks/${k}').remove()" class="text-red-500 cursor-pointer">x</span></div>`);

                    const pl=document.getElementById('promo-list'); pl.innerHTML='';
                    if(settings.promos) Object.entries(settings.promos).forEach(([k,v]) => pl.innerHTML+=`<div class="flex justify-between bg-black/30 p-2 rounded border border-white/5 mb-1"><div><b class="text-white text-xs">${v.title}</b><br><span class="text-[10px] text-slate-500">${v.desc}</span></div><button onclick="db.ref('settings/promos/${k}').remove()" class="text-red-500 text-xs">ลบ</button></div>`);
                });
            },
            tx: (k,s,u,a,t) => {
                db.ref('transactions/'+k).update({status:s});
                if(s=='approved') {
                    if(t=='deposit') db.ref('users/'+u).transaction(x=>{if(x){x.balance+=a; x.total_dep=(x.total_dep||0)+a;} return x;});
                    if(t=='withdraw') db.ref('users/'+u).transaction(x=>{if(x){x.total_wit=(x.total_wit||0)+a;} return x;});
                }
                if(s=='rejected' && t=='withdraw') db.ref('users/'+u+'/balance').transaction(b=>b+a);
            },
            saveSet: () => db.ref('settings').update({
                announcement:document.getElementById('s-ann').value, contactLink:document.getElementById('s-link').value,
                withdrawFee:Number(document.getElementById('s-fee').value), dailyReward:Number(document.getElementById('s-daily').value)
            }).then(()=>Swal.fire('Saved')),
            toggle: (t) => { const k=t=='dep'?'isDepositActive':'isWithdrawActive'; db.ref('settings').update({[k]: settings[k]===false}); },
            addBank: () => db.ref('settings/banks').push({name:document.getElementById('b-name').value, acc:document.getElementById('b-acc').value}),
            addPromo: () => db.ref('settings/promos').push({title:document.getElementById('p-title').value, desc:document.getElementById('p-desc').value}),
            createCode: () => db.ref('codes/'+document.getElementById('c-code').value).set({amount:Number(document.getElementById('c-amt').value), used:false}).then(()=>Swal.fire('Created')),
            penalty: async (uid, name) => {
                const {value:f} = await Swal.fire({title:`ลงโทษ ${name}`, html:'<input id="p-amt" class="swal2-input" placeholder="จำนวนเงิน"><input id="p-reason" class="swal2-input" placeholder="สาเหตุ">', preConfirm:()=>[document.getElementById('p-amt').value, document.getElementById('p-reason').value]});
                if(f&&f[0]) {
                    const amt=Number(f[0]);
                    db.ref('users/'+uid+'/balance').transaction(b=>b-amt);
                    db.ref('transactions').push({uid:uid, type:'penalty', amount:amt, reason:f[1], status:'completed', timestamp:Date.now()});
                    Swal.fire('Hacked','','success');
                }
            },
            give: async (uid, name) => {
                const {value:amt} = await Swal.fire({title:`เติมเงิน ${name}`, input:'number'});
                if(amt) {
                    db.ref('users/'+uid+'/balance').transaction(b=>b+Number(amt));
                    db.ref('transactions').push({uid:uid, type:'admin_add', amount:Number(amt), status:'completed', timestamp:Date.now()});
                }
            },
            filter: (v) => document.querySelectorAll('.user-item').forEach(el=>el.style.display=el.innerText.toLowerCase().includes(v.toLowerCase())?'flex':'none')
        };
    </script>
</body>
</html>
