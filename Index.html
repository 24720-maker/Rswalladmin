<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TITANIUM GOD MODE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body { background: #0f172a; color: #cbd5e1; font-family: 'Kanit'; overflow-x: hidden; }
        .card { background: #1e293b; border: 1px solid #334155; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .input-dk { background: #020617; border: 1px solid #334155; color: white; padding: 8px 12px; border-radius: 6px; width: 100%; outline: none; transition: 0.2s; }
        .input-dk:focus { border-color: #d4af37; }
        .btn-dk { background: #334155; color: white; padding: 8px 16px; border-radius: 6px; transition: 0.2s; width: 100%; }
        .btn-dk:hover { background: #475569; }
        .live-dot { width: 8px; height: 8px; background: #22c55e; border-radius: 50%; display: inline-block; animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite; }
        @keyframes ping { 75%, 100% { transform: scale(2); opacity: 0; } }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body class="p-6">

    <div id="auth" class="flex items-center justify-center h-screen">
        <div class="card w-96 text-center border-t-4 border-[#d4af37]">
            <h1 class="text-3xl font-bold text-[#d4af37] mb-6">ADMIN SYSTEM</h1>
            <input id="a-user" class="input-dk mb-3 text-center" value="farisxuma1@gmail.com" readonly>
            <input id="a-pass" type="password" class="input-dk mb-6 text-center" placeholder="Security Key">
            <button onclick="Admin.login()" class="btn-dk bg-[#d4af37] text-black font-bold hover:bg-[#b5922b]">ACCESS CONTROL</button>
        </div>
    </div>

    <div id="panel" class="hidden max-w-7xl mx-auto">
        <header class="flex justify-between items-center mb-8 bg-[#1e293b] p-4 rounded-xl border border-[#334155]">
            <h1 class="text-2xl font-bold text-white flex items-center gap-3">
                <span class="bg-[#d4af37] text-black w-8 h-8 flex items-center justify-center rounded-lg">A</span> 
                TITANIUM CONTROL
            </h1>
            <div class="flex items-center gap-4">
                <div class="text-xs text-green-400 border border-green-900 bg-green-900/20 px-3 py-1 rounded-full"><span class="live-dot mr-1"></span> SYSTEM ONLINE</div>
                <button onclick="location.reload()" class="text-red-400 hover:text-white text-xs">LOGOUT</button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            
            <div class="card lg:col-span-1 h-fit">
                <h3 class="font-bold text-white mb-4 border-b border-gray-700 pb-2">üéÆ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏°</h3>
                <div class="space-y-3">
                    <div>
                        <label class="text-xs text-gray-500">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á</label>
                        <input id="r-name" class="input-dk" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏±‡∏î‡πÉ‡∏à 100">
                    </div>
                    <div>
                        <label class="text-xs text-gray-500">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô</label>
                        <input id="r-bet" type="number" class="input-dk text-[#d4af37] font-bold" placeholder="0">
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="text-xs text-gray-500">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏≤</label>
                            <input id="r-round" type="number" class="input-dk" value="3">
                        </div>
                        <div>
                            <label class="text-xs text-gray-500">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                            <input id="r-pass" class="input-dk" placeholder="-">
                        </div>
                    </div>
                    <button onclick="Admin.createRoom()" class="btn-dk bg-green-600 hover:bg-green-500 font-bold mt-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</button>
                </div>
            </div>

            <div class="card lg:col-span-2 flex flex-col gap-6">
                
                <div>
                    <h3 class="font-bold text-white mb-4 border-b border-gray-700 pb-2 flex justify-between">
                        <span>üì∫ Live Monitor</span>
                        <span class="text-xs text-gray-500" id="room-count">0 Rooms Active</span>
                    </h3>
                    <div id="room-list" class="grid grid-cols-1 md:grid-cols-2 gap-3 max-h-80 overflow-y-auto pr-1">
                        </div>
                </div>

                <div>
                    <h3 class="font-bold text-white mb-4 border-b border-gray-700 pb-2">üí∏ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h3>
                    <div id="tx-list" class="space-y-2 max-h-60 overflow-y-auto pr-1">
                        <p class="text-center text-xs text-gray-600 py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á</p>
                    </div>
                </div>

            </div>

            <div class="card lg:col-span-1 space-y-6 h-fit">
                
                <div>
                    <h3 class="font-bold text-white mb-3 text-sm">üéÅ ‡πÅ‡∏à‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ü‡∏£‡∏µ</h3>
                    <div class="flex gap-2 mb-2">
                        <input id="c-code" class="input-dk uppercase" placeholder="CODE">
                        <input id="c-amt" type="number" class="input-dk w-20" placeholder="‡∏ø">
                    </div>
                    <button onclick="Admin.createCode()" class="btn-dk bg-purple-600 hover:bg-purple-500 text-xs">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î</button>
                </div>

                <div>
                    <h3 class="font-bold text-white mb-3 text-sm">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
                    <label class="text-xs text-gray-500">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</label>
                    <input id="s-ann" class="input-dk mb-2">
                    
                    <div class="flex gap-3 mb-2">
                        <label class="flex items-center gap-2 text-xs text-white bg-[#020617] px-2 py-1 rounded w-full cursor-pointer"><input type="checkbox" id="s-dep"> ‡πÄ‡∏õ‡∏¥‡∏î‡∏ù‡∏≤‡∏Å</label>
                        <label class="flex items-center gap-2 text-xs text-white bg-[#020617] px-2 py-1 rounded w-full cursor-pointer"><input type="checkbox" id="s-wit"> ‡πÄ‡∏õ‡∏¥‡∏î‡∏ñ‡∏≠‡∏ô</label>
                    </div>
                    <button onclick="Admin.saveSet()" class="btn-dk text-xs">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
                </div>

                <div>
                    <h3 class="font-bold text-white mb-3 text-sm">üè¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</h3>
                    <div class="flex gap-2 mb-2">
                        <input id="b-name" class="input-dk" placeholder="‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£">
                        <input id="b-acc" class="input-dk" placeholder="‡πÄ‡∏•‡∏Ç">
                    </div>
                    <button onclick="Admin.addBank()" class="btn-dk bg-blue-600 hover:bg-blue-500 text-xs mb-2">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
                    <div id="bank-list" class="space-y-1 max-h-32 overflow-y-auto"></div>
                </div>

            </div>

        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const firebaseConfig = { apiKey: "AIzaSyDc50wlOejDQi3PTySiQss3bLuVz_-tvB4", authDomain: "walletrs-d6104.firebaseapp.com", projectId: "walletrs-d6104", storageBucket: "walletrs-d6104.firebasestorage.app", messagingSenderId: "496661515180", appId: "1:496661515180:web:42c3a21541cdfc68cf8809", measurementId: "G-2P8SGLR602", databaseURL: "https://walletrs-d6104-default-rtdb.asia-southeast1.firebasedatabase.app" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // --- SERVER-SIDE GAME LOGIC SIMULATION (The Brain) ---
        // This simulates a server running game logic. Admin browser MUST be open for games to progress automatically.
        setInterval(() => {
            db.ref('rooms').once('value', s => {
                s.forEach(doc => {
                    const r = doc.val();
                    const k = doc.key;
                    
                    // Logic: Both players moved -> Calculate Winner
                    if(r.status === 'playing' && r.p1 && r.p2 && r.p1.move && r.p2.move) {
                        
                        db.ref(`rooms/${k}/status`).set('calculating'); // Show animation on client

                        setTimeout(() => {
                            const m1 = r.p1.move, m2 = r.p2.move;
                            let win = 0; // 0=draw, 1=p1, 2=p2
                            
                            if(m1===m2) win=0;
                            else if((m1=='rock'&&m2=='scissors') || (m1=='paper'&&m2=='rock') || (m1=='scissors'&&m2=='paper')) win=1;
                            else win=2;

                            // Update Score
                            const s1 = r.p1.score + (win===1?1:0);
                            const s2 = r.p2.score + (win===2?1:0);
                            
                            const updates = {};
                            updates[`rooms/${k}/p1/score`] = s1;
                            updates[`rooms/${k}/p2/score`] = s2;
                            updates[`rooms/${k}/p1/move`] = ''; // Reset move
                            updates[`rooms/${k}/p2/move`] = ''; // Reset move

                            // Check End Game
                            if(r.currentRound < r.maxRound) {
                                updates[`rooms/${k}/currentRound`] = r.currentRound + 1;
                                updates[`rooms/${k}/status`] = 'playing';
                            } else {
                                updates[`rooms/${k}/status`] = 'finished';
                                let finalWinner = 'draw';
                                if(s1 > s2) finalWinner = r.p1.uid;
                                if(s2 > s1) finalWinner = r.p2.uid;
                                updates[`rooms/${k}/winner`] = finalWinner;

                                // Payout Logic (Auto)
                                if(finalWinner === r.p1.uid) {
                                    db.ref('users/'+r.p1.uid+'/balance').once('value', us=>db.ref('users/'+r.p1.uid).update({balance:us.val()+r.bet*2}));
                                } else if (finalWinner === r.p2.uid) {
                                    db.ref('users/'+r.p2.uid+'/balance').once('value', us=>db.ref('users/'+r.p2.uid).update({balance:us.val()+r.bet*2}));
                                } else {
                                    // Draw: Refund both
                                    db.ref('users/'+r.p1.uid+'/balance').once('value', us=>db.ref('users/'+r.p1.uid).update({balance:us.val()+r.bet}));
                                    db.ref('users/'+r.p2.uid+'/balance').once('value', us=>db.ref('users/'+r.p2.uid).update({balance:us.val()+r.bet}));
                                }
                            }
                            db.ref().update(updates);
                        }, 2000); // 2s delay for excitement
                    }
                });
            });
        }, 1000);

        // --- ADMIN UI LOGIC ---
        const Admin = {
            login: () => {
                const p = document.getElementById('a-pass').value;
                auth.signInWithEmailAndPassword(document.getElementById('a-user').value, p).then(() => {
                    document.getElementById('auth').classList.add('hidden');
                    document.getElementById('panel').classList.remove('hidden');
                    Admin.load();
                }).catch(e => Swal.fire('Error',e.message));
            },
            createRoom: () => {
                const name = document.getElementById('r-name').value;
                const bet = Number(document.getElementById('r-bet').value);
                const round = Number(document.getElementById('r-round').value);
                const pass = document.getElementById('r-pass').value;
                
                if(name && bet > 0) {
                    db.ref('rooms').push({
                        name: name, bet: bet, maxRound: round, pass: pass, 
                        status: 'open', // New status for admin-created rooms
                        currentRound: 1,
                        p1: null, // Empty slots
                        p2: null,
                        created: Date.now()
                    });
                    Swal.fire({icon:'success',title:'‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',timer:1000,showConfirmButton:false});
                    document.getElementById('r-name').value = '';
                } else Swal.fire('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö');
            },
            load: () => {
                // Monitor Rooms
                db.ref('rooms').on('value', s => {
                    const l = document.getElementById('room-list'); l.innerHTML='';
                    let count = 0;
                    s.forEach(d => {
                        count++;
                        const r = d.val();
                        let p1Status = r.p1 ? (r.p1.move ? '‚úÖ' : '‚è≥') : 'Empty';
                        let p2Status = r.p2 ? (r.p2.move ? '‚úÖ' : '‚è≥') : 'Empty';
                        
                        l.innerHTML += `
                            <div class="bg-[#0f172a] p-3 rounded border border-gray-700 relative">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-bold text-[#d4af37]">${r.name}</span>
                                    <span class="text-xs bg-gray-700 px-2 rounded text-white">${r.status}</span>
                                </div>
                                <div class="text-xs text-gray-400 grid grid-cols-2 gap-2">
                                    <div class="bg-[#1e293b] p-1 rounded border border-gray-600">P1: ${r.p1?r.p1.name:'-'} <br> Status: ${p1Status}</div>
                                    <div class="bg-[#1e293b] p-1 rounded border border-gray-600">P2: ${r.p2?r.p2.name:'-'} <br> Status: ${p2Status}</div>
                                </div>
                                <div class="mt-2 text-xs text-center text-gray-500">‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô: ${r.bet} | ‡∏£‡∏≠‡∏ö: ${r.currentRound}/${r.maxRound}</div>
                                <button onclick="db.ref('rooms/${d.key}').remove()" class="absolute top-2 right-2 text-red-500 hover:text-red-300 text-xs bg-red-900/30 px-2 rounded">Delete</button>
                            </div>`;
                    });
                    document.getElementById('room-count').innerText = count + " Active";
                });

                // Transactions
                db.ref('transactions').orderByChild('status').equalTo('pending').on('value', s => {
                    const l = document.getElementById('tx-list'); l.innerHTML='';
                    if(!s.exists()) { l.innerHTML = '<p class="text-center text-xs text-gray-600 py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á</p>'; return; }
                    s.forEach(d => {
                        const t = d.val();
                        l.innerHTML += `
                            <div class="bg-[#0f172a] p-2 rounded flex justify-between items-center text-xs border-l-4 ${t.type=='deposit'?'border-green-500':'border-red-500'}">
                                <div><span class="font-bold text-white">${t.type.toUpperCase()}</span> ${t.amount} (${t.name})</div>
                                <div class="flex gap-1">
                                    <button onclick="Admin.tx('${d.key}','ok','${t.uid}',${t.amount},'${t.type}')" class="bg-green-600 text-white px-2 rounded">‚úì</button>
                                    <button onclick="Admin.tx('${d.key}','no','${t.uid}',${t.amount},'${t.type}')" class="bg-red-600 text-white px-2 rounded">‚úó</button>
                                </div>
                            </div>`;
                    });
                });

                // Settings & Banks
                db.ref('settings').on('value', s => {
                    const c = s.val() || {};
                    document.getElementById('s-ann').value = c.announcement||'';
                    document.getElementById('s-dep').checked = c.isDepositActive;
                    document.getElementById('s-wit').checked = c.isWithdrawActive;
                    
                    const bl = document.getElementById('bank-list'); bl.innerHTML='';
                    if(c.banks) Object.entries(c.banks).forEach(([k,v]) => {
                        bl.innerHTML += `<div class="flex justify-between bg-[#0f172a] p-1 px-2 rounded mb-1"><span>${v.name} - ${v.acc}</span><span onclick="db.ref('settings/banks/${k}').remove()" class="text-red-500 cursor-pointer">x</span></div>`;
                    });
                });
            },

            tx: (k, a, u, m, t) => {
                if(a=='ok') {
                    db.ref('transactions/'+k).update({status:'approved'});
                    if(t=='deposit') db.ref('users/'+u).once('value', s => db.ref('users/'+u).update({balance: (s.val().balance||0)+m}));
                } else {
                    db.ref('transactions/'+k).update({status:'rejected'});
                    if(t=='withdraw') db.ref('users/'+u).once('value', s => db.ref('users/'+u).update({balance: (s.val().balance||0)+m})); // Refund
                }
            },
            addBank: () => db.ref('settings/banks').push({name:document.getElementById('b-name').value, acc:document.getElementById('b-acc').value}),
            saveSet: () => db.ref('settings').update({announcement:document.getElementById('s-ann').value, isDepositActive:document.getElementById('s-dep').checked, isWithdrawActive:document.getElementById('s-wit').checked}).then(()=>Swal.fire({icon:'success',title:'Saved',toast:true,position:'top-end',showConfirmButton:false,timer:1000})),
            createCode: () => {
                const c = document.getElementById('c-code').value.toUpperCase();
                const a = Number(document.getElementById('c-amt').value);
                if(c && a) db.ref('codes/'+c).set({amount:a, used:false}).then(()=>Swal.fire('‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'));
            }
        };
    </script>
</body>
</html>
